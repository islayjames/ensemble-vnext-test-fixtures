# Flutter CI/CD Deployment Examples
# All commands use non-interactive flags for automation compatibility
#
# CRITICAL: Never use interactive commands in CI/CD:
# - Always use -d <device_id> for device selection
# - Always use explicit build targets (apk, appbundle, ios, web)
# - Use --suppress-analytics to disable prompts
# - Pin Flutter version for reproducible builds

# =============================================================================
# GITHUB ACTIONS - Analyze and Test
# =============================================================================
#
# name: Flutter CI
#
# on:
#   push:
#     branches: [main, develop]
#   pull_request:
#     branches: [main]
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   analyze:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           channel: stable
#           cache: true
#
#       - name: Get dependencies
#         run: flutter pub get
#
#       - name: Analyze code
#         run: flutter analyze --fatal-infos
#
#       - name: Run tests
#         run: flutter test --coverage
#
#       - name: Upload coverage
#         uses: codecov/codecov-action@v4
#         with:
#           files: coverage/lcov.info

# =============================================================================
# GITHUB ACTIONS - Build Android
# =============================================================================
#
# name: Build Android
#
# on:
#   push:
#     branches: [main]
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   build-android:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: actions/setup-java@v4
#         with:
#           distribution: 'temurin'
#           java-version: '17'
#
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#
#       - name: Get dependencies
#         run: flutter pub get
#
#       - name: Build APK (debug)
#         run: flutter build apk --debug
#
#       - name: Build App Bundle (release)
#         run: flutter build appbundle --release
#
#       - name: Upload APK
#         uses: actions/upload-artifact@v4
#         with:
#           name: android-apk
#           path: build/app/outputs/flutter-apk/app-debug.apk
#
#       - name: Upload AAB
#         uses: actions/upload-artifact@v4
#         with:
#           name: android-aab
#           path: build/app/outputs/bundle/release/app-release.aab

# =============================================================================
# GITHUB ACTIONS - Build iOS (No Codesign for CI)
# =============================================================================
#
# name: Build iOS
#
# on:
#   push:
#     branches: [main]
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   build-ios:
#     runs-on: macos-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#
#       - name: Get dependencies
#         run: flutter pub get
#
#       - name: Build iOS (no codesign)
#         run: flutter build ios --release --no-codesign
#
#       - name: Upload iOS build
#         uses: actions/upload-artifact@v4
#         with:
#           name: ios-build
#           path: build/ios/iphoneos/

# =============================================================================
# GITHUB ACTIONS - Build iOS with Signing (TestFlight)
# =============================================================================
#
# name: Build iOS for TestFlight
#
# on:
#   push:
#     branches: [main]
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   build-ios-signed:
#     runs-on: macos-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#
#       - name: Install Apple certificate
#         env:
#           BUILD_CERTIFICATE_BASE64: ${{ secrets.BUILD_CERTIFICATE_BASE64 }}
#           P12_PASSWORD: ${{ secrets.P12_PASSWORD }}
#           KEYCHAIN_PASSWORD: ${{ secrets.KEYCHAIN_PASSWORD }}
#         run: |
#           CERTIFICATE_PATH=$RUNNER_TEMP/build_certificate.p12
#           KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db
#
#           echo -n "$BUILD_CERTIFICATE_BASE64" | base64 --decode -o $CERTIFICATE_PATH
#
#           security create-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
#           security set-keychain-settings -lut 21600 $KEYCHAIN_PATH
#           security unlock-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
#           security import $CERTIFICATE_PATH -P "$P12_PASSWORD" -A -t cert -f pkcs12 -k $KEYCHAIN_PATH
#           security list-keychain -d user -s $KEYCHAIN_PATH
#
#       - name: Install provisioning profile
#         env:
#           PROVISIONING_PROFILE_BASE64: ${{ secrets.PROVISIONING_PROFILE_BASE64 }}
#         run: |
#           PP_PATH=$RUNNER_TEMP/build_pp.mobileprovision
#           echo -n "$PROVISIONING_PROFILE_BASE64" | base64 --decode -o $PP_PATH
#           mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
#           cp $PP_PATH ~/Library/MobileDevice/Provisioning\ Profiles/
#
#       - name: Get dependencies
#         run: flutter pub get
#
#       - name: Build IPA
#         run: flutter build ipa --release --export-options-plist=ios/ExportOptions.plist
#
#       - name: Upload to TestFlight
#         env:
#           APP_STORE_CONNECT_API_KEY: ${{ secrets.APP_STORE_CONNECT_API_KEY }}
#         run: |
#           xcrun altool --upload-app \
#             --type ios \
#             --file build/ios/ipa/*.ipa \
#             --apiKey ${{ secrets.API_KEY_ID }} \
#             --apiIssuer ${{ secrets.API_ISSUER_ID }}

# =============================================================================
# GITHUB ACTIONS - Build Web
# =============================================================================
#
# name: Build and Deploy Web
#
# on:
#   push:
#     branches: [main]
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   build-web:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#
#       - name: Get dependencies
#         run: flutter pub get
#
#       - name: Build web
#         run: flutter build web --release --web-renderer canvaskit
#
#       - name: Upload web build
#         uses: actions/upload-artifact@v4
#         with:
#           name: web-build
#           path: build/web/
#
#       # Deploy to Firebase Hosting
#       - name: Deploy to Firebase
#         uses: FirebaseExtended/action-hosting-deploy@v0
#         with:
#           repoToken: ${{ secrets.GITHUB_TOKEN }}
#           firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
#           channelId: live
#           projectId: your-project-id

# =============================================================================
# GITHUB ACTIONS - Multi-Platform Build
# =============================================================================
#
# name: Multi-Platform Build
#
# on:
#   push:
#     branches: [main]
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   test:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#       - run: flutter pub get
#       - run: flutter analyze
#       - run: flutter test
#
#   build-android:
#     needs: test
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: actions/setup-java@v4
#         with:
#           distribution: 'temurin'
#           java-version: '17'
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#       - run: flutter pub get
#       - run: flutter build appbundle --release
#       - uses: actions/upload-artifact@v4
#         with:
#           name: android-aab
#           path: build/app/outputs/bundle/release/
#
#   build-ios:
#     needs: test
#     runs-on: macos-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#       - run: flutter pub get
#       - run: flutter build ios --release --no-codesign
#       - uses: actions/upload-artifact@v4
#         with:
#           name: ios-build
#           path: build/ios/iphoneos/
#
#   build-web:
#     needs: test
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#       - run: flutter pub get
#       - run: flutter build web --release
#       - uses: actions/upload-artifact@v4
#         with:
#           name: web-build
#           path: build/web/

# =============================================================================
# GITHUB ACTIONS - With Flavors
# =============================================================================
#
# name: Build with Flavors
#
# on:
#   push:
#     branches:
#       - main        # Production
#       - develop     # Development
#
# env:
#   FLUTTER_VERSION: "3.24.0"
#
# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#
#       - uses: actions/setup-java@v4
#         with:
#           distribution: 'temurin'
#           java-version: '17'
#
#       - uses: subosito/flutter-action@v2
#         with:
#           flutter-version: ${{ env.FLUTTER_VERSION }}
#           cache: true
#
#       - run: flutter pub get
#
#       - name: Build Development
#         if: github.ref == 'refs/heads/develop'
#         run: flutter build apk --flavor development --release
#
#       - name: Build Production
#         if: github.ref == 'refs/heads/main'
#         run: flutter build appbundle --flavor production --release

# =============================================================================
# GITLAB CI
# =============================================================================
#
# stages:
#   - test
#   - build
#
# variables:
#   FLUTTER_VERSION: "3.24.0"
#
# test:
#   stage: test
#   image: ghcr.io/cirruslabs/flutter:$FLUTTER_VERSION
#   script:
#     - flutter pub get
#     - flutter analyze
#     - flutter test --coverage
#   artifacts:
#     reports:
#       coverage_report:
#         coverage_format: lcov
#         path: coverage/lcov.info
#
# build-android:
#   stage: build
#   image: ghcr.io/cirruslabs/flutter:$FLUTTER_VERSION
#   script:
#     - flutter pub get
#     - flutter build appbundle --release
#   artifacts:
#     paths:
#       - build/app/outputs/bundle/release/
#   only:
#     - main
#
# build-web:
#   stage: build
#   image: ghcr.io/cirruslabs/flutter:$FLUTTER_VERSION
#   script:
#     - flutter pub get
#     - flutter build web --release
#   artifacts:
#     paths:
#       - build/web/
#   only:
#     - main

# =============================================================================
# CODEMAGIC (codemagic.yaml)
# =============================================================================
#
# workflows:
#   android-workflow:
#     name: Android Build
#     max_build_duration: 60
#     environment:
#       flutter: 3.24.0
#       java: 17
#     scripts:
#       - name: Get dependencies
#         script: flutter pub get
#       - name: Run tests
#         script: flutter test
#       - name: Build APK
#         script: flutter build apk --release
#     artifacts:
#       - build/app/outputs/flutter-apk/*.apk
#
#   ios-workflow:
#     name: iOS Build
#     max_build_duration: 60
#     instance_type: mac_mini_m2
#     environment:
#       flutter: 3.24.0
#       xcode: latest
#     scripts:
#       - name: Get dependencies
#         script: flutter pub get
#       - name: Build iOS
#         script: flutter build ios --release --no-codesign
#     artifacts:
#       - build/ios/iphoneos/*.app

# =============================================================================
# IMPORTANT NOTES
# =============================================================================
#
# 1. ALWAYS pin Flutter version for reproducible builds
# 2. ALWAYS use non-interactive flags (-d, explicit targets)
# 3. Use subosito/flutter-action@v2 for GitHub Actions
# 4. Use cache: true to speed up builds
# 5. Run tests before building
# 6. For iOS signing, use Fastlane Match or manual certificate management
# 7. For Android signing, use key.properties and keep keystore secure
# 8. Consider using Codemagic for simpler iOS signing setup
